<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Life.Tune - Create Account</title>
  <link rel="stylesheet" href="styles.css" />
  <style>
    #loadingOverlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(255, 255, 255, 0.8);
      z-index: 9999;

      display: flex;
      justify-content: center;
      align-items: center;
      font-size: 24px;
      color: #333;
      font-weight: bold;
    }
  </style>
	<script>
	  window.onload = function() {
		// Hide overlay just in case
		document.getElementById("loadingOverlay").style.display = "none";
	  };

    function showLoading() {
      document.getElementById("loadingOverlay").style.display = "flex";
    }
	window.addEventListener("pageshow", function (event) {
      document.getElementById("loadingOverlay").style.display = "none";
	});
  </script>
</head>
<body class="login-body">

  <main class="login container">
    <!-- Welcome Section -->
    <div class="login-welcome">
      <img
        src="img/bird LIFE.TUNE logo.png"
        alt="Life.Tune logo"
        class="login-logo"
      >
      <p class="login-subtitle">Create your account to start your journey</p>
    </div>

    <!-- Register Form Card -->
    <div class="login-card">
      <form class="login-form" action="register_process" method="post" onsubmit="showLoading()">
        <div class="form-group">
          <label for="email" class="form-label">
            <svg viewBox="0 0 24 24" class="input-icon">
              <path d="M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z"/>
            </svg>
            Email Address
          </label>
          <input
            type="email"
            id="email"
            name="email"
            placeholder="Enter your email"
            required
            class="form-input"
          >
          <span class="error" id="emailError" style="color:red;"></span>
        </div>
        
        <div class="form-group">
          <label for="password" class="form-label">
            <svg viewBox="0 0 24 24" class="input-icon">
              <path d="M18 8h-1V6c0-2.76-2.24-5-5-5S7 3.24 7 6v2H6c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V10c0-1.1-.9-2-2-2zm-6 9c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2zm3.1-9H8.9V6c0-1.71 1.39-3.1 3.1-3.1 1.71 0 3.1 1.39 3.1 3.1v2z"/>
            </svg>
            Password
          </label>
          <input
            type="password"
            id="password"
            name="password"
            placeholder="Enter your password"
            required
            class="form-input"
          >
          <span class="error" id="passwordError" style="color:red;"></span>
        </div>

        <div class="form-group">
          <label for="password2" class="form-label">
            <svg viewBox="0 0 24 24" class="input-icon">
              <path d="M18 8h-1V6c0-2.76-2.24-5-5-5S7 3.24 7 6v2H6c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V10c0-1.1-.9-2-2-2zm-6 9c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2zm3.1-9H8.9V6c0-1.71 1.39-3.1 3.1-3.1 1.71 0 3.1 1.39 3.1 3.1v2z"/>
            </svg>
            Confirm Password
          </label>
          <input
            type="password"
            id="password2"
            name="password2"
            placeholder="Re-enter your password"
            required
            class="form-input"
          >
          <span class="error2" id="passwordError2" style="color:red;"></span>
        </div>

        <div class="form-actions">
          <button class="btn-login" type="submit" id="confirm-btn">
            Create Account
          </button>
        </div>
      </form>

      <!-- Links -->
      <div class="login-links">
        <a href="login" class="link-item">
          <svg viewBox="0 0 24 24" class="link-icon">
            <path d="M11 7L9.6 8.4l2.6 2.6H2v2h10.2l-2.6 2.6L11 17l5-5-5-5z"/>
          </svg>
          Already have an account? Sign In
        </a>
      </div>
    </div>

    <div id="loadingOverlay"><img src="img/loading2.gif" alt="Loading..." /></div>
  </main>

  <!-- fixed bottom navigation -->
  <nav class="bottom-nav">
    <button class="nav-item" aria-label="Home" onclick="location.href='index'">
      <svg viewBox="0 0 24 24" class="nav-icon"><path d="M3 9.5L12 3l9 6.5V21a1 1 0 0 1-1 1h-5v-7H9v7H4a1 1 0 0 1-1-1V9.5z"/></svg>
      <span class="nav-label">Home</span>
    </button>
    <button class="nav-item" aria-label="AI Assistant" onclick="location.href='aichat'">
      <svg viewBox="0 0 24 24" class="nav-icon"><path d="M4 17h2v-7H4v7zm4 0h2V7H8v10zm4 0h2v-4h-2v4zm4 0h2v-9h-2v9z"/></svg>
      <span class="nav-label">AI Assistant</span>
    </button>
    <button class="nav-item" aria-label="Insight" onclick="location.href='result'">
      <svg viewBox="0 0 24 24" class="nav-icon"><path d="M12 2a10 10 0 1 0 0 20 10 10 0 0 0 0-20zm.93 15h-1.86v-1.86h1.86V17zm1.52-7.1c-.2.3-.4.6-.4 1 0 .6.4 1 1 1s1-.4 1-1c0-1-.6-1.7-1.6-2.5-.8-.6-1.2-1-1.2-1.9 0-1.1.9-2 2-2s2 .9 2 2h2a4 4 0 0 0-4-4c-2.3 0-4 1.7-4 4 0 1.2.6 2 1.6 2.8.9.6 1.4 1 1.4 1.8 0 .6-.4 1-1 1z"/></svg>
      <span class="nav-label">Insight</span>
    </button>
    <button class="nav-item" aria-label="Profile" id="profile-btn" onclick="location.href='profile'">
      <svg viewBox="0 0 24 24" class="nav-icon"><path d="M12 12a5 5 0 1 0-5-5 5 5 0 0 0 5 5zm0 2c-3.3 0-10 1.7-10 5v3h20v-3c0-3.3-6.7-5-10-5z"/></svg>
      <span class="nav-label">Profile</span>
    </button>
  </nav> 
  <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
  <script>
    const emailInput = document.getElementById('email');
    const passwordInput = document.getElementById('password');
	const passwordInput2 = document.getElementById('password2');
    const submitBtn = document.getElementById('confirm-btn');
    const emailError = document.getElementById('emailError');
	const emailError2 = document.getElementById('emailError2');
    const passwordError = document.getElementById('passwordError');

    let isEmailValid = false;
    let isPasswordValid = false;
    let isEmailUnique = false;
	let isPasswordMatch = false;

    function validateEmailFormat(email) {
      return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
    }

    function validatePassword(password) {
      return /^(?=.*[a-z])(?=.*[A-Z])(?=.*\d).{8,}$/.test(password);
    }

    function checkFormStatus() {
      submitBtn.disabled = !(isEmailValid && isPasswordValid && isEmailUnique && isPasswordMatch);
    }

    emailInput.addEventListener('input', () => {
      const email = emailInput.value.trim();
      isEmailValid = validateEmailFormat(email);

      if (!isEmailValid) {
        emailError.textContent = ' Invalid format';
        isEmailUnique = false;
        checkFormStatus();
        return;
      }

      // AJAX check for duplicate
      fetch(`checkemail?q=${encodeURIComponent(email)}`)
        .then(res => res.text())
        .then(data => {
          if (data === 'exists') {
            emailError.textContent = ' already exists';
            isEmailUnique = false;
          } else {
            emailError.textContent = '';
            isEmailUnique = true;
          }
          checkFormStatus();
        });
    });

    passwordInput.addEventListener('input', () => {
      const password = passwordInput.value;
      isPasswordValid = validatePassword(password);
      passwordError.textContent = isPasswordValid
        ? ''
        : ' must be 8+ chars, include uppercase, lowercase, and number';
      checkFormStatus();
    });
	
	passwordInput2.addEventListener('input', () => {
	  const password = passwordInput.value;
      const password2 = passwordInput2.value;
      if (password !== password2) {
		passwordError2.textContent = ' do not match!';
		isPasswordMatch = false
	  } else {
	    passwordError2.textContent = '';
		isPasswordMatch = true
	  }
	  checkFormStatus();	  
    });
/*
	const birthdateInput = document.getElementById('birthdate');
    const today = new Date().toISOString().split('T')[0];
	
    birthdateInput.setAttribute('max', today);

    // time‚Äêonly picker
    flatpickr("input[name='birthtime']", {
      enableTime: true,
      noCalendar: true,
      dateFormat: "H:i",   // e.g. "14:30"
      time_24hr: false     // set to true if you want 24-hour clock
    });*/
  </script>
</body>
</html>
